import{r as f,j as t}from"./react-vendor-9c8TE4CQ.js";import{u as q,s as j,n as E}from"./index-BAhLtW8a.js";import{P as k,q as B,D as A,u as D,I as T,F as G,aU as O}from"./icons-CrYPN78F.js";import"./vendor-D0b57E6Q.js";import"./pdf-BS8VfjLT.js";import"./supabase-CpXiahKC.js";import"./router-D4Yn-kk_.js";import"./charts-D-0nM1O5.js";import"./date-utils-DhyeW5k6.js";const C="peptide_tracker_inventory",L=10,P=()=>{const[i,d]=f.useState([]),[I,x]=f.useState(!0),{user:m}=q();f.useEffect(()=>{m?u():v()},[m]);const v=()=>{try{const a=localStorage.getItem(C);a&&d(JSON.parse(a))}catch(a){console.error("Error loading inventory from localStorage:",a)}x(!1)},y=a=>{try{localStorage.setItem(C,JSON.stringify(a))}catch(s){console.error("Error saving inventory to localStorage:",s)}},u=async()=>{try{x(!0);const{data:a,error:s}=await j.from("inventory").select("*").order("created_at",{ascending:!1});if(s)throw s;d(a||[]),p(a||[])}catch(a){console.error("Error fetching inventory:",a),v()}finally{x(!1)}},p=a=>{a.forEach(s=>{if(s.remaining_mg<=L&&s.remaining_mg>0){const o=localStorage.getItem(`low_stock_notified_${s.id}`),r=Date.now(),e=1440*60*1e3;(!o||r-parseInt(o)>e)&&(E.sendLowStockAlert(s.peptide_name,s.remaining_mg,"mg"),localStorage.setItem(`low_stock_notified_${s.id}`,r.toString()))}})},g=async a=>{const s={id:"temp-"+Date.now(),...a,remaining_mg:a.quantity_mg,created_at:new Date().toISOString()},o=[s,...i];if(d(o),m)try{const{data:r,error:e}=await j.from("inventory").insert([{user_id:m.id,peptide_name:a.peptide_name,quantity_mg:a.quantity_mg,remaining_mg:a.quantity_mg,purchase_date:a.purchase_date||null,expiration_date:a.expiration_date||null,batch_number:a.batch_number||null,source:a.source||null}]).select().single();if(e)throw e;d(_=>_.map(w=>w.id===s.id?r:w))}catch(r){console.error("Error adding inventory:",r),u()}else y(o)},h=async(a,s)=>{const o=i.map(r=>r.id===a?{...r,...s}:r);if(d(o),m)try{const{error:r}=await j.from("inventory").update(s).eq("id",a);if(r)throw r;const e=o.find(_=>_.id===a);e&&p([e])}catch(r){console.error("Error updating inventory:",r),u()}else y(o)};return{inventory:i,loading:I,addInventory:g,updateInventory:h,deleteInventory:async a=>{const s=i.filter(o=>o.id!==a);if(d(s),m)try{const{error:o}=await j.from("inventory").delete().eq("id",a);if(o)throw o}catch(o){console.error("Error deleting inventory:",o),u()}else y(s)},deductFromInventory:async(a,s)=>{const o=i.filter(e=>e.peptide_name===a&&e.remaining_mg>0).sort((e,_)=>new Date(e.created_at)-new Date(_.created_at))[0];if(!o)return console.log("No inventory found for",a),!1;const r=Math.max(0,o.remaining_mg-s);return await h(o.id,{remaining_mg:r}),!0},getLowStockItems:()=>i.filter(a=>a.remaining_mg<=L&&a.remaining_mg>0),getExpiringItems:(a=30)=>{const s=new Date;return s.setDate(s.getDate()+a),i.filter(o=>o.expiration_date?new Date(o.expiration_date)<=s&&o.remaining_mg>0:!1)},getTotalStock:(a=null)=>(a?i.filter(o=>o.peptide_name===a):i).reduce((o,r)=>o+(r.remaining_mg||0),0),refetch:u}},M="_container_ncf58_1",F="_header_ncf58_8",V="_addButton_ncf58_25",$="_statsGrid_ncf58_44",z="_statCard_ncf58_51",R="_statIcon_ncf58_61",W="_statInfo_ncf58_72",H="_statValue_ncf58_77",J="_statLabel_ncf58_83",K="_inventoryList_ncf58_88",U="_inventoryItem_ncf58_94",Y="_itemInfo_ncf58_110",Q="_itemName_ncf58_116",X="_lowStockBadge_ncf58_125",Z="_itemDetails_ncf58_137",tt="_itemActions_ncf58_144",et="_actionBtn_ncf58_150",nt="_deleteBtn_ncf58_169",at="_stockBarWrapper_ncf58_174",st="_stockBar_ncf58_174",ot="_low_ncf58_125",rt="_emptyState_ncf58_194",ct="_modal_ncf58_209",it="_modalContent_ncf58_221",lt="_formGroup_ncf58_238",dt="_modalActions_ncf58_265",mt="_cancelBtn_ncf58_272",_t="_submitBtn_ncf58_281",n={container:M,header:F,addButton:V,statsGrid:$,statCard:z,statIcon:R,statInfo:W,statValue:H,statLabel:J,inventoryList:K,inventoryItem:U,itemInfo:Y,itemName:Q,lowStockBadge:X,itemDetails:Z,itemActions:tt,actionBtn:et,deleteBtn:nt,stockBarWrapper:at,stockBar:st,low:ot,emptyState:rt,modal:ct,modalContent:it,formGroup:lt,modalActions:dt,cancelBtn:mt,submitBtn:_t},It=()=>{const{inventory:i,addInventory:d,updateInventory:I,deleteInventory:x,getLowStockItems:m,getExpiringItems:v,getTotalStock:y}=P(),[u,p]=f.useState(!1),[g,h]=f.useState(null),[c,l]=f.useState({peptide_name:"",quantity_mg:"",source:"",purchase_date:new Date().toISOString().split("T")[0],expiration_date:"",batch_number:""}),N=m();v(60);const S=async e=>{e.preventDefault();const _={...c,quantity_mg:parseFloat(c.quantity_mg)};g?await I(g.id,_):await d(_),s()},b=()=>{h(null),l({peptide_name:"",quantity_mg:"",source:"",purchase_date:new Date().toISOString().split("T")[0],expiration_date:"",batch_number:""}),p(!0)},a=e=>{h(e),l({peptide_name:e.peptide_name,quantity_mg:e.quantity_mg,source:e.source||"",purchase_date:e.purchase_date?e.purchase_date.split("T")[0]:"",expiration_date:e.expiration_date?e.expiration_date.split("T")[0]:"",batch_number:e.batch_number||""}),p(!0)},s=()=>{p(!1),h(null)},o=async e=>{window.confirm("Are you sure you want to delete this item?")&&await x(e)},r=e=>!e.quantity_mg||e.quantity_mg===0?0:Math.min(100,Math.max(0,e.remaining_mg/e.quantity_mg*100));return t.jsxs("div",{className:n.container,children:[t.jsxs("header",{className:n.header,children:[t.jsx("div",{children:t.jsxs("h1",{children:[t.jsx(k,{className:n.icon})," Inventory"]})}),t.jsxs("button",{className:n.addButton,onClick:b,children:[t.jsx(B,{size:20})," Add Item"]})]}),t.jsxs("div",{className:n.statsGrid,children:[t.jsxs("div",{className:n.statCard,children:[t.jsx("div",{className:n.statIcon,style:{background:"rgba(59, 130, 246, 0.15)",color:"#3b82f6"},children:t.jsx(k,{})}),t.jsxs("div",{className:n.statInfo,children:[t.jsx("span",{className:n.statValue,children:i.length}),t.jsx("span",{className:n.statLabel,children:"Total Items"})]})]}),t.jsxs("div",{className:n.statCard,children:[t.jsx("div",{className:n.statIcon,style:{background:"rgba(16, 185, 129, 0.15)",color:"#10b981"},children:t.jsx(A,{})}),t.jsxs("div",{className:n.statInfo,children:[t.jsxs("span",{className:n.statValue,children:[Math.round(y()),"mg"]}),t.jsx("span",{className:n.statLabel,children:"Total Stock"})]})]}),t.jsxs("div",{className:n.statCard,children:[t.jsx("div",{className:n.statIcon,style:{background:"rgba(239, 68, 68, 0.15)",color:"#ef4444"},children:t.jsx(D,{})}),t.jsxs("div",{className:n.statInfo,children:[t.jsx("span",{className:n.statValue,children:N.length}),t.jsx("span",{className:n.statLabel,children:"Low Stock"})]})]})]}),i.length>0?t.jsx("div",{className:n.inventoryList,children:i.map(e=>t.jsxs("div",{className:n.inventoryItem,children:[t.jsxs("div",{className:n.itemInfo,children:[t.jsxs("div",{className:n.itemName,children:[e.peptide_name,e.remaining_mg<=10&&t.jsxs("span",{className:n.lowStockBadge,children:[t.jsx(D,{size:12})," Low Stock"]})]}),t.jsxs("div",{className:n.itemDetails,children:[t.jsxs("span",{children:[e.remaining_mg,"mg remaining (of ",e.quantity_mg,"mg)"]}),e.source&&t.jsxs("span",{children:["• ",e.source]}),e.batch_number&&t.jsxs("span",{children:["• Batch: ",e.batch_number]})]}),t.jsx("div",{className:n.stockBarWrapper,children:t.jsx("div",{className:`${n.stockBar} ${e.remaining_mg<=10?n.low:""}`,style:{width:`${r(e)}%`}})})]}),t.jsxs("div",{className:n.itemActions,children:[t.jsx("button",{className:n.actionBtn,onClick:()=>a(e),title:"Edit Item",children:t.jsx(T,{size:16})}),t.jsx("button",{className:`${n.actionBtn} ${n.deleteBtn}`,onClick:()=>o(e.id),title:"Delete Item",children:t.jsx(G,{size:16})})]})]},e.id))}):t.jsxs("div",{className:n.emptyState,children:[t.jsx(O,{size:48,style:{opacity:.5,marginBottom:"1rem"}}),t.jsx("h3",{children:"Your inventory is empty"}),t.jsx("p",{children:"Track your peptide stock, sources, and expiration dates."}),t.jsxs("button",{className:n.addButton,onClick:b,style:{marginTop:"1.5rem",marginInline:"auto"},children:[t.jsx(B,{size:20})," Add First Item"]})]}),u&&t.jsx("div",{className:n.modal,onClick:s,children:t.jsxs("div",{className:n.modalContent,onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{children:g?"Edit Item":"Add to Inventory"}),t.jsxs("form",{onSubmit:S,children:[t.jsxs("div",{className:n.formGroup,children:[t.jsx("label",{children:"Peptide Name"}),t.jsx("input",{type:"text",required:!0,value:c.peptide_name,onChange:e=>l({...c,peptide_name:e.target.value}),placeholder:"e.g. BPC-157"})]}),t.jsxs("div",{className:n.formGroup,children:[t.jsx("label",{children:"Quantity (mg)"}),t.jsx("input",{type:"number",required:!0,min:"0",step:"0.1",value:c.quantity_mg,onChange:e=>l({...c,quantity_mg:e.target.value}),placeholder:"e.g. 5"})]}),t.jsxs("div",{className:n.formGroup,children:[t.jsx("label",{children:"Source / Vendor (Optional)"}),t.jsx("input",{type:"text",value:c.source,onChange:e=>l({...c,source:e.target.value}),placeholder:"e.g. Biotech Peptides"})]}),t.jsxs("div",{className:n.formGroup,children:[t.jsx("label",{children:"Batch Number (Optional)"}),t.jsx("input",{type:"text",value:c.batch_number,onChange:e=>l({...c,batch_number:e.target.value}),placeholder:"e.g. B492-A"})]}),t.jsxs("div",{className:n.formGroup,children:[t.jsx("label",{children:"Purchase Date"}),t.jsx("input",{type:"date",value:c.purchase_date,onChange:e=>l({...c,purchase_date:e.target.value})})]}),t.jsxs("div",{className:n.formGroup,children:[t.jsx("label",{children:"Expiration Date (Optional)"}),t.jsx("input",{type:"date",value:c.expiration_date,onChange:e=>l({...c,expiration_date:e.target.value})})]}),t.jsxs("div",{className:n.modalActions,children:[t.jsx("button",{type:"button",className:n.cancelBtn,onClick:s,children:"Cancel"}),t.jsx("button",{type:"submit",className:n.submitBtn,children:g?"Update Item":"Add Item"})]})]})]})})]})};export{It as default};
