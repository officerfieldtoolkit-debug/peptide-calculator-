import{r,o as K,e as X,p as Y,d as Q,q as V,t as b,j as e,f as z,v as Z,w as ee,x as te,y as se}from"./vendor-C6dEa9Ot.js";import{a as L,s as I,P as ae}from"./index-BaUPF9kk.js";import{ae as oe,C as E,af as ne,a5 as ce,a3 as de,X as le,P as k,p as re,ag as ie,m as ue}from"./icons-BTDfCNaD.js";import"./charts-DMvJngN5.js";const M="peptide_tracker_schedule",me=()=>{const[u,m]=r.useState([]),[C,j]=r.useState(!0),{user:p}=L();r.useEffect(()=>{p?h():y()},[p]);const y=()=>{try{const o=localStorage.getItem(M);o&&m(JSON.parse(o))}catch(o){console.error("Error loading from localStorage:",o)}j(!1)},i=o=>{try{localStorage.setItem(M,JSON.stringify(o))}catch(a){console.error("Error saving to localStorage:",a)}},h=async()=>{try{j(!0);const{data:o,error:a}=await I.from("schedules").select("*").order("scheduled_date",{ascending:!0});if(a)throw a;const n=o.map(c=>({id:c.id,date:new Date(`${c.scheduled_date}T${c.scheduled_time}`).toISOString(),peptide:c.peptide_name,dosage:c.dosage,unit:c.unit,time:c.scheduled_time.slice(0,5),completed:c.completed,notes:c.notes}));m(n)}catch(o){console.error("Error fetching schedules:",o),y()}finally{j(!1)}};return{schedules:u,loading:C,addSchedule:async o=>{const a={id:"temp-"+Date.now(),completed:!1,...o},n=[...u,a];if(m(n),p)try{const c=new Date(o.date),{data:l,error:S}=await I.from("schedules").insert([{user_id:p.id,peptide_name:o.peptide,dosage:o.dosage,unit:o.unit,scheduled_date:c.toISOString().split("T")[0],scheduled_time:o.time+":00",completed:!1,notes:o.notes||null}]).select().single();if(S)throw S;m(N=>N.map(_=>_.id===a.id?{..._,id:l.id}:_))}catch(c){console.error("Error adding schedule:",c),h()}else i(n)},deleteSchedule:async o=>{const a=u.filter(n=>n.id!==o);if(m(a),p)try{const{error:n}=await I.from("schedules").delete().eq("id",o);if(n)throw n}catch(n){console.error("Error deleting schedule:",n),h()}else i(a)},toggleComplete:async o=>{const a=u.find(l=>l.id===o);if(!a)return;const n=!a.completed,c=u.map(l=>l.id===o?{...l,completed:n}:l);if(m(c),p)try{const{error:l}=await I.from("schedules").update({completed:n}).eq("id",o);if(l)throw l}catch(l){console.error("Error toggling schedule:",l),h()}else i(c)}}},pe="_container_10z61_1",he="_pageHeader_10z61_11",_e="_headerLeft_10z61_18",ge="_headerIcon_10z61_24",fe="_guestBadge_10z61_44",xe="_loadingState_10z61_58",je="_spinner_10z61_68",Se="_calendarCard_10z61_83",ye="_calendarHeader_10z61_87",Ne="_monthDisplay_10z61_94",ve="_todayBtn_10z61_108",ze="_navBtn_10z61_124",Ie="_grid_10z61_144",Ce="_dayHeader_10z61_150",De="_day_10z61_150",be="_selected_10z61_180",Be="_today_10z61_108",we="_dayNumber_10z61_186",Ee="_dimmed_10z61_197",ke="_dots_10z61_206",Me="_dot_10z61_206",Te="_completedDot_10z61_222",Le="_moreCount_10z61_226",Oe="_detailsSection_10z61_233",Pe="_detailsHeader_10z61_237",He="_dateSubtitle_10z61_253",Ae="_addBtn_10z61_259",$e="_addBtnActive_10z61_279",Ge="_form_10z61_291",Fe="_inputGroup_10z61_326",Re="_formRow_10z61_355",We="_autocompleteWrapper_10z61_372",qe="_autocomplete_10z61_372",Ue="_autocompleteItem_10z61_390",Je="_submitBtn_10z61_410",Ke="_scheduleList_10z61_434",Xe="_emptyState_10z61_440",Ye="_emptyIcon_10z61_450",Qe="_scheduleItem_10z61_467",Ve="_completedItem_10z61_482",Ze="_schedulePeptide_10z61_486",et="_scheduleToggle_10z61_490",tt="_checkIcon_10z61_500",st="_circleIcon_10z61_504",at="_scheduleInfo_10z61_513",ot="_scheduleDetails_10z61_525",nt="_scheduleNotes_10z61_530",ct="_deleteBtn_10z61_537",s={container:pe,pageHeader:he,headerLeft:_e,headerIcon:ge,guestBadge:fe,loadingState:xe,spinner:je,calendarCard:Se,calendarHeader:ye,monthDisplay:Ne,todayBtn:ve,navBtn:ze,grid:Ie,dayHeader:Ce,day:De,selected:be,today:Be,dayNumber:we,dimmed:Ee,dots:ke,dot:Me,completedDot:Te,moreCount:Le,detailsSection:Oe,detailsHeader:Pe,dateSubtitle:He,addBtn:Ae,addBtnActive:$e,form:Ge,inputGroup:Fe,formRow:Re,autocompleteWrapper:We,autocomplete:qe,autocompleteItem:Ue,submitBtn:Je,scheduleList:Ke,emptyState:Xe,emptyIcon:Ye,scheduleItem:Qe,completedItem:Ve,schedulePeptide:Ze,scheduleToggle:et,checkIcon:tt,circleIcon:st,scheduleInfo:at,scheduleDetails:ot,scheduleNotes:nt,deleteBtn:ct},T=Object.keys(ae),dt=()=>{const{schedules:u,loading:m,addSchedule:C,deleteSchedule:j,toggleComplete:p}=me(),{user:y}=L(),[i,h]=r.useState(new Date),[g,D]=r.useState(new Date),[f,o]=r.useState(!1),[a,n]=r.useState({peptide:"",dosage:"",unit:"mg",time:"08:00",notes:""}),[c,l]=r.useState(!1),[S,N]=r.useState([]),_=r.useRef(null);r.useEffect(()=>{if(a.peptide){const t=a.peptide.toLowerCase(),d=T.filter(x=>x.toLowerCase().includes(t)).slice(0,6);N(d)}else N(T.slice(0,6))},[a.peptide]),r.useEffect(()=>{const t=d=>{_.current&&!_.current.contains(d.target)&&l(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const O=K({start:Q(V(i)),end:X(Y(i))}),P=()=>h(se(i,1)),H=()=>h(te(i)),A=()=>{const t=new Date;h(t),D(t)},$=t=>{D(t),o(!1)},G=t=>{n({...a,peptide:t}),l(!1)},F=t=>{t.preventDefault(),!(!a.peptide||!a.dosage)&&(C({date:g.toISOString(),peptide:a.peptide,dosage:parseFloat(a.dosage),unit:a.unit,time:a.time,notes:a.notes||null}),n({peptide:"",dosage:"",unit:"mg",time:"08:00",notes:""}),o(!1))},B=t=>{try{const d=new Date(t.date);return isNaN(d.getTime())?null:d}catch{return null}},w=u.filter(t=>{const d=B(t);return d&&b(d,g)}),R=t=>u.filter(d=>{const x=B(d);return x&&b(x,t)});return m?e.jsx("div",{className:s.container,children:e.jsxs("div",{className:s.loadingState,children:[e.jsx(oe,{size:32,className:s.spinner}),e.jsx("p",{children:"Loading schedule..."})]})}):e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.pageHeader,children:[e.jsxs("div",{className:s.headerLeft,children:[e.jsx(E,{size:28,className:s.headerIcon}),e.jsxs("div",{children:[e.jsx("h1",{children:"Injection Schedule"}),e.jsx("p",{children:"Plan and track your doses"})]})]}),!y&&e.jsxs("div",{className:s.guestBadge,children:[e.jsx(ne,{size:14}),"Guest Mode"]})]}),e.jsxs("div",{className:`card glass-panel ${s.calendarCard}`,children:[e.jsxs("div",{className:s.calendarHeader,children:[e.jsx("button",{onClick:H,className:s.navBtn,"aria-label":"Previous month",children:e.jsx(ce,{size:20})}),e.jsxs("div",{className:s.monthDisplay,children:[e.jsx("h2",{children:z(i,"MMMM yyyy")}),e.jsx("button",{onClick:A,className:s.todayBtn,children:"Today"})]}),e.jsx("button",{onClick:P,className:s.navBtn,"aria-label":"Next month",children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:s.grid,children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:s.dayHeader,children:t},t)),O.map(t=>{const d=R(t),x=d.length>0;d.filter(v=>v.completed).length;const W=b(t,g),q=Z(t,i),U=ee(t);return e.jsxs("button",{className:`${s.day} ${q?"":s.dimmed} ${W?s.selected:""} ${U?s.today:""}`,onClick:()=>$(t),children:[e.jsx("span",{className:s.dayNumber,children:z(t,"d")}),x&&e.jsxs("div",{className:s.dots,children:[d.slice(0,3).map((v,J)=>e.jsx("div",{className:`${s.dot} ${v.completed?s.completedDot:""}`},v.id||J)),d.length>3&&e.jsxs("span",{className:s.moreCount,children:["+",d.length-3]})]})]},t.toISOString())})]})]}),e.jsxs("div",{className:`card glass-panel ${s.detailsSection}`,children:[e.jsxs("div",{className:s.detailsHeader,children:[e.jsxs("div",{children:[e.jsx("h3",{children:z(g,"EEEE")}),e.jsx("p",{className:s.dateSubtitle,children:z(g,"MMMM d, yyyy")})]}),e.jsxs("button",{className:`${s.addBtn} ${f?s.addBtnActive:""}`,onClick:()=>o(!f),children:[f?e.jsx(le,{size:18}):e.jsx(k,{size:18}),f?"Cancel":"Add"]})]}),f&&e.jsxs("form",{className:s.form,onSubmit:F,children:[e.jsxs("div",{className:s.inputGroup,ref:_,children:[e.jsx("label",{children:"Peptide"}),e.jsxs("div",{className:s.autocompleteWrapper,children:[e.jsx("input",{type:"text",value:a.peptide,onChange:t=>n({...a,peptide:t.target.value}),onFocus:()=>l(!0),placeholder:"Search peptide...",autoComplete:"off",required:!0}),c&&S.length>0&&e.jsx("div",{className:s.autocomplete,children:S.map(t=>e.jsx("button",{type:"button",className:s.autocompleteItem,onClick:()=>G(t),children:t},t))})]})]}),e.jsxs("div",{className:s.formRow,children:[e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Dosage"}),e.jsx("input",{type:"number",step:"0.01",value:a.dosage,onChange:t=>n({...a,dosage:t.target.value}),placeholder:"0.5",required:!0})]}),e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Unit"}),e.jsxs("select",{value:a.unit,onChange:t=>n({...a,unit:t.target.value}),children:[e.jsx("option",{value:"mg",children:"mg"}),e.jsx("option",{value:"mcg",children:"mcg"}),e.jsx("option",{value:"IU",children:"IU"})]})]}),e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Time"}),e.jsx("input",{type:"time",value:a.time,onChange:t=>n({...a,time:t.target.value})})]})]}),e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Notes (optional)"}),e.jsx("input",{type:"text",value:a.notes,onChange:t=>n({...a,notes:t.target.value}),placeholder:"e.g., Take with food"})]}),e.jsxs("button",{type:"submit",className:s.submitBtn,children:[e.jsx(k,{size:18}),"Add to Schedule"]})]}),e.jsx("div",{className:s.scheduleList,children:w.length===0?e.jsxs("div",{className:s.emptyState,children:[e.jsx(E,{size:40,className:s.emptyIcon}),e.jsx("p",{children:"No doses scheduled"}),e.jsx("span",{children:'Tap "Add" to schedule a dose for this day'})]}):w.map(t=>e.jsxs("div",{className:`${s.scheduleItem} ${t.completed?s.completedItem:""}`,children:[e.jsx("button",{className:s.scheduleToggle,onClick:()=>p(t.id),"aria-label":t.completed?"Mark as incomplete":"Mark as complete",children:t.completed?e.jsx(re,{className:s.checkIcon,size:24}):e.jsx(ie,{className:s.circleIcon,size:24})}),e.jsxs("div",{className:s.scheduleInfo,children:[e.jsx("span",{className:s.schedulePeptide,children:t.peptide}),e.jsxs("span",{className:s.scheduleDetails,children:[t.dosage," ",t.unit," â€¢ ",t.time]}),t.notes&&e.jsx("span",{className:s.scheduleNotes,children:t.notes})]}),e.jsx("button",{className:s.deleteBtn,onClick:()=>j(t.id),"aria-label":"Delete schedule",children:e.jsx(ue,{size:18})})]},t.id))})]})]})},mt=()=>e.jsx("div",{className:"padding-container",style:{padding:"20px"},children:e.jsx(dt,{})});export{mt as default};
